---
layout: post
date: 2019-06-17
title: Malware analysis on macOS
---

I have this old 2010 Mac Mini that I still use for a couple of things. It has a lot of storage attached to it that I use as fileserver, to cache some things and to dump backups onto. It's not exactly the newest machine, but it still handles quite well. One thing that bothered me lately was that it takes a bit to boot. Having the stock macOS full disk encryption (Apple calls this FileVault) and a slow HDD probably doesn't help. So, I decided to pop in an SSD and reinstall macOS on that.

In the process of doing so, I ran into a small issue, however. I needed to get an installer for macOS 10.13.6 High Sierra, the last version of macOS still supported by the Mac Mini. That is technically easy, because you can just download it from the App Store using this [link](https://itunes.apple.com/de/app/macos-high-sierra/id1246284741?mt=12). However, that took a bit too long, so I did some searching, to possibly find a torrent that would let me download it faster.

Now, I know that torrents aren't exactly the safest source of things, especially anything execuable. Anyone can upload a torrent, and there are some things that include software that is more on the shady side of things. But hey, this is macOS after all. In my ~10 years of using macOS, I have never really come across any malware. The security model of macOS is pretty decent. There is an App Store with Apps that are reviewed by Apple, all of those Apps run in sandboxes, and the App Store takes care of updating things. Everything else I install with [homebrew](https://brew.sh/), which is community-maintained, and it checks hashes of anything it downloads.

Even things you download from the Internet won't be run unless they are signed by a valid developer certificate. That ensures that people who create malicious apps can have their certificate revoked, limiting the damage. Even kernel extensions are cryptographically signed. However, the downside of all this is that the weakest link in the chain is always the human. You can bypass these security restrictions, if macOS warns you that it's not launchin an Applicatoin you downloaded from the internet because it's not signed, you can still force it to open it. And the problem is, people do, at least sometimes.

Well, I did manage to find a website that offered to download macOS High Sierra 10.13.6, exactly what I was looking for. And so I downloaded it. But there was something immediately phony about the download: it was only ~500 kB. Normally, an installation image should be around 6 GB in size. That definitely got me curious. What did I just download? What would this thing do?

Downloads usually come as .dmg files on macOS, these are disk images, a remnant from the time where software was distributed in the form of physical disks. These are compressed and contain a small file system, that you can mount. So I did.

Unsurprisingly, I found a small installer inside. I do think that some people would be dumb enough to just launch it, withouth checking what it does, but that's not what I was planning to do. This being macOS malware, which is basically fruitless, I was quite sure that this was written by some kid. It might actually do something, but it's probably nothing advanced. So I went ahead, opened Terminal.app, and checked what's in there.

A bash script. How interesting. I mean, it's quite obvious, if you're writing malware for a platform, you'd probably want to do it as simple as possible, and use the things that are preinstalled. And macOS happens to come with `bash` and `openssl`, so they used that.
